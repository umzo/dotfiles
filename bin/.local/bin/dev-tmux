#!/bin/bash

if [ -z "$1" ]; then
  echo "Usage: $0 <session-name> [directory]" >&2
  exit 1
fi

SESSION="$1"
DIR="${2:-$(pwd)}"

# 既存セッションがあればアタッチ
if tmux has-session -t $SESSION 2>/dev/null; then
  tmux attach -t $SESSION
  exit 0
fi

# セッション作成（上段：ペイン0）
tmux new-session -d -s $SESSION -c "$DIR"

# 下に分割（下段：ペイン1）- claudeが入る全幅のペイン
tmux split-window -v -t $SESSION -c "$DIR"

# 上段（ペイン0）を選択して右に分割（右上：ペイン2）
tmux select-pane -t $SESSION:0.0
tmux split-window -h -t $SESSION -c "$DIR"

# レイアウト調整（下を大きく：60%）
tmux resize-pane -t $SESSION:0.1 -y 60%

# 各ペインでコマンド実行
# ペイン0: 左上 → lazygit
# ペイン1: 右上 → y
# ペイン2: 下（全幅） → claude
tmux send-keys -t $SESSION:0.0 'lazygit' C-m
tmux send-keys -t $SESSION:0.1 'y' C-m
tmux send-keys -t $SESSION:0.2 'claude' C-m

tmux attach -t $SESSION
