#!/bin/bash
set -e

PORT=6419
FILE="$1"

if [ -z "$FILE" ]; then
  echo "Usage: mdpreview <file.md>"
  exit 1
fi

# Kill existing mdserve on the same port
lsof -ti:"$PORT" | xargs kill 2>/dev/null || true

# Open browser after a short delay
(sleep 1 && open "http://127.0.0.1:$PORT") &

mdserve -p "$PORT" "$FILE"
